<?php
#
# MIME types from file name extension
#
$mime_types = array (
  'ez'=>'application/andrew-inset', 'csm'=>'application/cu-seeme', 'cu'=>'application/cu-seeme', 
  'tsp'=>'application/dsptype', 'spl'=>'application/x-futuresplash', 'cpt'=>'image/x-corelphotopaint', 
  'hqx'=>'application/mac-binhex40', 'nb'=>'application/mathematica', 'mdb'=>'application/msaccess', 
  'doc'=>'application/msword', 'dot'=>'application/msword', 'bin'=>'application/octet-stream', 
  'oda'=>'application/oda', 'pdf'=>'application/pdf', 'pgp'=>'application/pgp-signature', 
  'ps'=>'application/postscript', 'ai'=>'application/postscript', 'eps'=>'application/postscript', 
  'rtf'=>'text/rtf', 'smi'=>'application/smil', 'smil'=>'application/smil', 
  'mif'=>'application/x-mif', 'xls'=>'application/vnd.ms-excel', 'xlb'=>'application/vnd.ms-excel', 
  'ppt'=>'application/vnd.ms-powerpoint', 'pps'=>'application/vnd.ms-powerpoint', 'pot'=>'application/vnd.ms-powerpoint', 
  'sdw'=>'application/vnd.stardivision.writer', 'sgl'=>'application/vnd.stardivision.writer-global', 'vor'=>'application/vnd.stardivision.writer', 
  'sdc'=>'application/vnd.stardivision.calc', 'sda'=>'application/vnd.stardivision.draw', 'sdd'=>'application/vnd.stardivision.impress', 
  'sdp'=>'application/vnd.stardivision.impress-packed', 'smf'=>'application/vnd.stardivision.math', 'sds'=>'application/vnd.stardivision.chart', 
  'smd'=>'application/vnd.stardivision.mail', 'wbxml'=>'application/vnd.wap.wbxml', 'wmlc'=>'application/vnd.wap.wmlc', 
  'wmlsc'=>'application/vnd.wap.wmlscriptc', 'wp5'=>'application/wordperfect5.1', 'zip'=>'application/zip', 
  'wk'=>'application/x-123', 'bcpio'=>'application/x-bcpio', 'vcd'=>'application/x-cdlink', 
  'pgn'=>'application/x-chess-pgn', 'cpio'=>'application/x-cpio', 'csh'=>'text/x-csh', 
  'deb'=>'application/x-debian-package', 'dcr'=>'application/x-director', 'dir'=>'application/x-director', 
  'dxr'=>'application/x-director', 'wad'=>'application/x-doom', 'dms'=>'application/x-dms', 
  'dvi'=>'application/x-dvi', 'pfa'=>'application/x-font', 'pfb'=>'application/x-font', 
  'gsf'=>'application/x-font', 'pcf'=>'application/x-font', 'pcf.Z'=>'application/x-font', 
  'gnumeric'=>'application/x-gnumeric', 'gtar'=>'application/x-gtar', 'tgz'=>'application/x-gtar', 
  'taz'=>'application/x-gtar', 'hdf'=>'application/x-hdf', 'phtml'=>'application/x-httpd-php', 
  'pht'=>'application/x-httpd-php', 'php'=>'application/x-httpd-php', 'phps'=>'application/x-httpd-php-source', 
  'php3'=>'application/x-httpd-php3', 'php3p'=>'application/x-httpd-php3-preprocessed', 'php4'=>'application/x-httpd-php4', 
  'ica'=>'application/x-ica', 'jar'=>'application/x-java-archive', 'jnlp'=>'application/x-java-jnlp-file', 
  'ser'=>'application/x-java-serialized-object', 'class'=>'application/x-java-vm', 'js'=>'application/x-javascript', 
  'chrt'=>'application/x-kchart', 'kil'=>'application/x-killustrator', 'kpr'=>'application/x-kpresenter', 
  'kpt'=>'application/x-kpresenter', 'skp'=>'application/x-koan', 'skd'=>'application/x-koan', 
  'skt'=>'application/x-koan', 'skm'=>'application/x-koan', 'ksp'=>'application/x-kspread', 
  'kwd'=>'application/x-kword', 'kwt'=>'application/x-kword', 'latex'=>'application/x-latex', 
  'lha'=>'application/x-lha', 'lzh'=>'application/x-lzh', 'lzx'=>'application/x-lzx', 
  'frm'=>'application/x-maker', 'maker'=>'application/x-maker', 'frame'=>'application/x-maker', 
  'fm'=>'application/x-maker', 'fb'=>'application/x-maker', 'book'=>'application/x-maker', 
  'fbdoc'=>'application/x-maker', 'com'=>'application/x-msdos-program', 'exe'=>'application/x-msdos-program', 
  'bat'=>'application/x-msdos-program', 'dll'=>'application/x-msdos-program', 'msi'=>'application/x-msi', 
  'nc'=>'application/x-netcdf', 'cdf'=>'application/x-netcdf', 'pac'=>'application/x-ns-proxy-autoconfig', 
  'o'=>'application/x-object', 'ogg'=>'application/x-ogg', 'oza'=>'application/x-oz-application', 
  'pl'=>'application/x-perl', 'pm'=>'application/x-perl', 'crl'=>'application/x-pkcs7-crl', 
  'rpm'=>'audio/x-pn-realaudio-plugin', 'shar'=>'application/x-shar', 'swf'=>'application/x-shockwave-flash', 
  'swfl'=>'application/x-shockwave-flash', 'sh'=>'text/x-sh', 'sit'=>'application/x-stuffit', 
  'sv4cpio'=>'application/x-sv4cpio', 'sv4crc'=>'application/x-sv4crc', 'tar'=>'application/x-tar', 
  'tcl'=>'text/x-tcl', 'tex'=>'text/x-tex', 'gf'=>'application/x-tex-gf', 
  'pk'=>'application/x-tex-pk', 'texinfo'=>'application/x-texinfo', 'texi'=>'application/x-texinfo', 
  '~'=>'application/x-trash', '%'=>'application/x-trash', 'bak'=>'application/x-trash', 
  'old'=>'application/x-trash', 'sik'=>'application/x-trash', 't'=>'application/x-troff', 
  'tr'=>'application/x-troff', 'roff'=>'application/x-troff', 'man'=>'application/x-troff-man', 
  'me'=>'application/x-troff-me', 'ms'=>'application/x-troff-ms', 'ustar'=>'application/x-ustar', 
  'src'=>'application/x-wais-source', 'wz'=>'application/x-wingz', 'crt'=>'application/x-x509-ca-cert', 
  'fig'=>'application/x-xfig', 'au'=>'audio/basic', 'snd'=>'audio/basic', 
  'mid'=>'audio/midi', 'midi'=>'audio/midi', 'kar'=>'audio/midi', 
  'mpga'=>'audio/mpeg', 'mpega'=>'audio/mpeg', 'mp2'=>'audio/mpeg', 
  'mp3'=>'audio/mpeg', 'm3u'=>'audio/x-mpegurl', 'sid'=>'audio/prs.sid', 
  'aif'=>'audio/x-aiff', 'aiff'=>'audio/x-aiff', 'aifc'=>'audio/x-aiff', 
  'gsm'=>'audio/x-gsm', 'ra'=>'audio/x-realaudio', 'rm'=>'audio/x-pn-realaudio', 
  'ram'=>'audio/x-pn-realaudio', 'pls'=>'audio/x-scpls', 'wav'=>'audio/x-wav', 
  'pdb'=>'chemical/x-pdb', 'xyz'=>'chemical/x-xyz', 'bmp'=>'image/x-ms-bmp', 
  'gif'=>'image/gif', 'ief'=>'image/ief', 'jpeg'=>'image/jpeg', 
  'jpg'=>'image/jpeg', 'jpe'=>'image/jpeg', 'pcx'=>'image/pcx', 
  'png'=>'image/png', 'svg'=>'image/svg+xml', 'svgz'=>'image/svg+xml', 
  'tiff'=>'image/tiff', 'tif'=>'image/tiff', 'wbmp'=>'image/vnd.wap.wbmp', 
  'ras'=>'image/x-cmu-raster', 'cdr'=>'image/x-coreldraw', 'pat'=>'image/x-coreldrawpattern', 
  'cdt'=>'image/x-coreldrawtemplate', 'djvu'=>'image/x-djvu', 'djv'=>'image/x-djvu', 
  'jng'=>'image/x-jng', 'pnm'=>'image/x-portable-anymap', 'pbm'=>'image/x-portable-bitmap', 
  'pgm'=>'image/x-portable-graymap', 'ppm'=>'image/x-portable-pixmap', 'rgb'=>'image/x-rgb', 
  'xbm'=>'image/x-xbitmap', 'xpm'=>'image/x-xpixmap', 'xwd'=>'image/x-xwindowdump', 
  'igs'=>'model/iges', 'iges'=>'model/iges', 'msh'=>'model/mesh', 
  'mesh'=>'model/mesh', 'silo'=>'model/mesh', 'wrl'=>'x-world/x-vrml', 
  'vrml'=>'x-world/x-vrml', 'csv'=>'text/comma-separated-values', 'css'=>'text/css', 
  'htm'=>'text/html', 'html'=>'text/html', 'xhtml'=>'text/html', 
  'mml'=>'text/mathml', 'asc'=>'text/plain', 'txt'=>'text/plain', 
  'text'=>'text/plain', 'diff'=>'text/plain', 'rtx'=>'text/richtext', 
  'tsv'=>'text/tab-separated-values', 'wml'=>'text/vnd.wap.wml', 'wmls'=>'text/vnd.wap.wmlscript', 
  'xml'=>'text/xml', 'xsl'=>'text/xml', 'h++'=>'text/x-c++hdr', 
  'hpp'=>'text/x-c++hdr', 'hxx'=>'text/x-c++hdr', 'hh'=>'text/x-c++hdr', 
  'c++'=>'text/x-c++src', 'cpp'=>'text/x-c++src', 'cxx'=>'text/x-c++src', 
  'cc'=>'text/x-c++src', 'h'=>'text/x-chdr', 'c'=>'text/x-csrc', 
  'java'=>'text/x-java', 'moc'=>'text/x-moc', 'p'=>'text/x-pascal', 
  'pas'=>'text/x-pascal', 'etx'=>'text/x-setext', 'tk'=>'text/x-tcl', 
  'ltx'=>'text/x-tex', 'sty'=>'text/x-tex', 'cls'=>'text/x-tex', 
  'vcs'=>'text/x-vcalendar', 'vcf'=>'text/x-vcard', 'dl'=>'video/dl', 
  'fli'=>'video/fli', 'gl'=>'video/gl', 'mpeg'=>'video/mpeg', 
  'mpg'=>'video/mpeg', 'mpe'=>'video/mpeg', 'qt'=>'video/quicktime', 
  'mov'=>'video/quicktime', 'mxu'=>'video/vnd.mpegurl', 'mng'=>'video/x-mng', 
  'asf'=>'video/x-ms-asf', 'asx'=>'video/x-ms-asf', 'avi'=>'video/x-msvideo', 
  'movie'=>'video/x-sgi-movie', 'ice'=>'x-conference/x-cooltalk', 'vrm'=>'x-world/x-vrml'
);

# --------------------------------------------------------------------
# Function: GetMimeFile
# Description: Dumps a file with MIME headers
#
function GetMimeFile($file='', $name='', $is_attachment=0) {
  global $mime_types;

  if ($name == '') $name = basename($file);
  $pi = pathinfo(strtolower($name));
  $mime_type = $mime_types[$pi['extension']];
  if ($mime_type == '') $mime_type = 'application/octet-stream';
  # dot bug with IE
  if (strstr($_SERVER['HTTP_USER_AGENT'], "MSIE")) {
    $name = preg_replace('/\./','%2e', $name, substr_count($name, '.') - 1);
  }
  header('MIME-Version: 1.0');
  header("Content-Type: $mime_type; name =\"".htmlentities($name)."\"");
  if ($is_attachment)
    header("Content-Disposition: attachment; filename=\"".htmlentities($name)."\"");
  else
    header("Content-Disposition: filename=\"".htmlentities($name)."\"");
  if ($file <> '' AND is_readable($file)) {
    $fp = fopen($file, "r");
    while (! feof($fp)) {
      print fread($fp,1024*1024);
      flush();
    }
    fclose($fp);
  }
}

?>